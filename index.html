<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>DeutscheGlobal Bank — Digital Banking</title>
  <meta name="description" content="DeutscheGlobal Bank — secure, mobile-first digital banking. Professional banking services, accounts, payments, investments and support." />
  <!-- Fonts & icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- jsPDF for receipts (used later) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /*
      Chunk 1 styles: Mobile-first, glassmorphism theme
      - Use custom properties for quick theme changes
      - Designed to be expanded in further chunks
    */
    :root{
      --bg: linear-gradient(180deg,#f5f7fb 0%, #eef3fb 100%);
      --glass: rgba(255,255,255,0.62);
      --glass-2: rgba(255,255,255,0.85);
      --primary: #003366;
      --accent: #ff6600;
      --muted: #6b7280;
      --card-shadow: 0 8px 30px rgba(2,6,23,0.08);
      --radius: 14px;
      --glass-border: rgba(255,255,255,0.5);
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);-webkit-font-smoothing:antialiased;color:#071423}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:0 1rem}
    .skip{position:absolute;left:-999px} .skip:focus{left:1rem;top:1rem;padding:.4rem .6rem;background:white;border-radius:6px;box-shadow:var(--card-shadow)}

    /* Header */
    header.site-header{
      position:sticky;top:0;z-index:120;
      background:linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.6));
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(2,6,23,0.04);
    }
    .header-inner{display:flex;align-items:center;justify-content:space-between;padding:.7rem 1rem;gap:.5rem}
    .brand{display:flex;align-items:center;gap:.6rem;cursor:pointer;user-select:none}
    .brand .mark{
      width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;
      background:linear-gradient(135deg,var(--primary),#0066cc);font-size:1.1rem;font-weight:800;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .brand .titles{line-height:1}
    .brand .title{font-weight:800;font-size:1rem}
    .brand .subtitle{font-size:.78rem;color:var(--muted);margin-top:2px}

    .header-actions{display:flex;align-items:center;gap:.6rem}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .9rem;border-radius:10px;border:none;background:var(--primary);color:white;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--primary);font-weight:700}
    .icon-btn{background:transparent;border-radius:10px;padding:.5rem;color:var(--muted);border:1px solid rgba(2,6,23,0.04)}

    /* Hero / landing */
    .hero{display:grid;grid-template-columns:1fr;gap:1rem;padding:1rem 0}
    .hero-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
      border-radius:var(--radius);box-shadow:var(--card-shadow);padding:1rem;border:1px solid var(--glass-border)
    }
    .hero-grid{display:grid;grid-template-columns:1fr;gap:.8rem}
    .hero h1{margin:0;font-size:1.5rem;line-height:1.05}
    .hero p.lead{color:var(--muted);margin-top:.5rem}

    .services{display:grid;grid-template-columns:repeat(2,1fr);gap:.6rem;margin-top:.7rem}
    .service{background:var(--glass-2);padding:.65rem;border-radius:12px;box-shadow:var(--card-shadow);border:1px solid rgba(255,255,255,0.6)}
    .service h4{margin:0;font-size:1rem}
    .service p{color:var(--muted);margin-top:.45rem;font-size:.92rem}

    .visuals{display:flex;gap:.6rem;margin-top:.6rem}
    .visuals img{width:100%;height:120px;object-fit:cover;border-radius:10px;box-shadow:var(--card-shadow)}

    /* Cards preview (Visa/Mastercard/Amex) */
    .card-stack{position:relative;height:180px;margin-top:.9rem}
    .card{
      position:absolute;width:320px;height:180px;border-radius:14px;color:white;padding:1rem;display:flex;flex-direction:column;justify-content:space-between;
      box-shadow:0 12px 30px rgba(2,6,23,0.12);
      transform-origin:center;
    }
    .card .brand{display:flex;align-items:center;gap:.6rem}
    .card .number{font-weight:800;font-size:1.35rem;letter-spacing:2px}
    .card.visa{background:linear-gradient(135deg,#113a63,#0066cc);left:0;top:0;transform:rotate(-6deg)}
    .card.mc{background:linear-gradient(135deg,#bd3e29,#ff6f2d);right:0;top:18px;transform:rotate(6deg);width:300px;height:160px}
    .card.amex{background:linear-gradient(135deg,#0da3ad,#06b6d4);left:20px;bottom:0;transform:rotate(-2deg);width:280px;height:150px}

    /* App shell placeholder (hidden until sign in) */
    .app-shell{display:none;margin-top:1rem}
    .app-grid{display:grid;grid-template-columns:1fr;gap:1rem}
    .onboarding{background:var(--glass-2);padding:1rem;border-radius:12px;border:1px solid rgba(255,255,255,0.6);box-shadow:var(--card-shadow)}

    /* footer */
    footer.site-footer{margin-top:1rem;padding:1rem 0;color:var(--muted);font-size:.92rem;border-top:1px solid rgba(2,6,23,0.04)}
    footer .foot-grid{display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;align-items:center}

    /* Modal basics */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:220}
    .modal{background:linear-gradient(180deg,rgba(255,255,255,0.98),white);border-radius:12px;padding:1rem;max-width:820px;width:100%;box-shadow:var(--card-shadow);border:1px solid rgba(2,6,23,0.04)}
    .modal h3{margin:0}
    .input{width:100%;padding:.6rem;border-radius:8px;border:1px solid rgba(2,6,23,0.06);margin-top:.5rem}

    /* small screens first; larger screens adapt */
    @media(min-width:880px){
      .hero{grid-template-columns:1fr 420px}
      .hero-grid{grid-template-columns:1fr}
      .services{grid-template-columns:repeat(3,1fr)}
      .visuals img{height:160px}
      .app-grid{grid-template-columns:260px 1fr}
      .card-stack{height:220px}
    }
  </style>
</head>

<body>
  <a class="skip" href="#main">Skip to main content</a>

  <header class="site-header" role="banner">
    <div class="container header-inner">
      <div class="brand" id="siteLogo" tabindex="0" role="button" aria-label="DeutscheGlobal Bank logo — triple-click for secure admin">
        <div class="mark"><i class="fa-solid fa-building-columns"></i></div>
        <div class="titles">
          <div class="title">DeutscheGlobal Bank</div>
          <div class="subtitle">Digital banking & premium services</div>
        </div>
      </div>

      <div class="header-actions" role="toolbar" aria-label="Top actions">
        <button id="openContact" class="btn secondary" aria-haspopup="dialog"><i class="fa-solid fa-phone"></i> Contact</button>
        <button id="openSignIn" class="btn"><i class="fa-solid fa-right-to-bracket"></i> Sign in</button>
      </div>
    </div>
  </header>

  <main id="main" class="container" role="main" aria-live="polite">
    <!-- HERO / LANDING -->
    <section class="hero" aria-labelledby="heroHeading">
      <div class="hero-card">
        <div class="hero-grid">
          <div>
            <h1 id="heroHeading">Banking crafted for your life</h1>
            <p class="lead">Modern accounts, global card acceptance and personalized financial tools — available on mobile and desktop. Secure, compliant, and designed for members across Germany and Europe.</p>

            <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
              <button id="ctaOpenRegister" class="btn"><i class="fa-solid fa-user-plus"></i> Open an account</button>
              <button id="ctaLearnMore" class="btn secondary"><i class="fa-solid fa-circle-info"></i> Learn more</button>
            </div>

            <div class="services" role="list" aria-label="Our services" style="margin-top:1rem">
              <div class="service" role="listitem">
                <h4>Accounts & Cards</h4>
                <p>Current, savings and business accounts with physical and virtual card options.</p>
              </div>
              <div class="service" role="listitem">
                <h4>Payments & FX</h4>
                <p>Fast internal transfers, SEPA payments and multi-currency wallet management.</p>
              </div>
              <div class="service" role="listitem">
                <h4>Investments & Loans</h4>
                <p>Portfolio tools, savings plans and tailored lending with clear terms.</p>
              </div>
            </div>
          </div>

          <aside>
            <!-- Card stack with well-known card brands -->
            <div class="card-stack" aria-hidden="true">
              <div class="card visa" role="img" aria-label="Visa debit card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-weight:700">DeutscheGlobal</div>
                  <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Visa_2014_logo_detail.svg" alt="Visa" style="height:20px;filter:brightness(1) saturate(1);"/>
                </div>
                <div class="number">**** **** **** 2345</div>
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-size:.82rem">Valid THRU 12/28</div>
                  <div style="font-size:.9rem">S. Meier</div>
                </div>
              </div>

              <div class="card mc" role="img" aria-label="Mastercard credit card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-weight:700">DeutscheGlobal</div>
                  <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png" alt="Mastercard" style="height:20px;filter:brightness(1)"/>
                </div>
                <div class="number">**** **** **** 9876</div>
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-size:.82rem">Valid THRU 07/27</div>
                  <div style="font-size:.9rem">A. Schmidt</div>
                </div>
              </div>

              <div class="card amex" role="img" aria-label="American Express corporate card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-weight:800">DGB</div>
                  <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg" alt="Amex" style="height:20px;filter:brightness(1)"/>
                </div>
                <div class="number">**** **** **** 4521</div>
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div style="font-size:.75rem">Valid THRU 10/29</div>
                  <div style="font-size:.8rem">Acme GmbH</div>
                </div>
              </div>
            </div>

            <!-- a gallery/people images (Unsplash) -->
            <div class="visuals" aria-hidden="false">
              <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=800&auto=format&fit=crop" alt="Smiling customer 1" />
              <img src="https://images.unsplash.com/photo-1531123414780-f0b6c9aee7b3?q=80&w=800&auto=format&fit=crop" alt="Business client" />
            </div>
          </aside>
        </div>
      </div>
    </section>

    <!-- App shell (hidden until authenticated) -->
    <section id="appShell" class="app-shell" aria-hidden="true">
      <div class="app-grid">
        <nav id="primaryNav" aria-label="Primary navigation">
          <!-- left nav will be rendered in next chunk -->
          <div class="onboarding">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div id="uNamePreview" style="font-weight:700">Welcome</div>
                <div id="uMailPreview" style="color:var(--muted);font-size:.9rem">user@example.com</div>
              </div>
              <div id="uBalancePreview" style="text-align:right">
                <div style="color:var(--muted);font-size:.8rem">Total</div>
                <div style="font-weight:800">€0.00</div>
              </div>
            </div>
            <div style="margin-top:.6rem"><button id="btnSignOut" class="btn secondary">Sign out</button></div>
          </div>
        </nav>

        <main id="appContent">
          <!-- dashboard / pages will be injected in later chunks -->
          <div class="onboarding">
            <h3>Welcome to DeutscheGlobal</h3>
            <p style="color:var(--muted)">Access your accounts, make payments, manage cards and loans — secure and fast.</p>
            <div style="margin-top:.6rem"><button id="btnSpeedTours" class="btn">Quick tour</button></div>
          </div>
        </main>
      </div>
    </section>

    <footer class="site-footer" role="contentinfo">
      <div class="container foot-grid">
        <div>© <strong>DeutscheGlobal Bank</strong> — All rights reserved.</div>
        <div style="color:var(--muted)"><a href="#privacy" style="color:var(--muted);text-decoration:none">Privacy</a> · <a href="#security" style="color:var(--muted);text-decoration:none">Security</a> · <a href="#contact" style="color:var(--muted);text-decoration:none">Contact</a></div>
      </div>
    </footer>
  </main>

  <!-- AUTH MODAL (Sign in / Register / Forgot) -->
  <div id="authModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="authHeading">
    <div class="modal" role="document" aria-live="assertive">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="authHeading">Sign in to your account</h3>
        <button id="closeAuth" class="btn secondary" aria-label="Close sign in modal">Close</button>
      </div>

      <div style="margin-top:.8rem;">
        <div id="authForms">
          <!-- Sign in -->
          <form id="formSignIn" style="display:block">
            <label class="skip" for="si_email">Email</label>
            <input id="si_email" class="input" type="email" placeholder="name@company.com" required autocomplete="username" />
            <label class="skip" for="si_password">Password</label>
            <input id="si_password" class="input" type="password" placeholder="Password" required autocomplete="current-password" />
            <div style="display:flex;gap:.6rem;margin-top:.6rem;align-items:center;justify-content:space-between">
              <button type="submit" class="btn">Sign in</button>
              <div style="display:flex;gap:.4rem">
                <button type="button" id="openRegister" class="btn secondary">Open account</button>
                <button type="button" id="openForgot" class="btn secondary">Forgot</button>
              </div>
            </div>
          </form>

          <!-- Register -->
          <form id="formRegister" style="display:none;margin-top:.6rem">
            <label class="skip" for="r_first">First name</label>
            <input id="r_first" class="input" placeholder="First name" required />
            <label class="skip" for="r_last">Last name</label>
            <input id="r_last" class="input" placeholder="Last name" required style="margin-top:.45rem" />
            <label class="skip" for="r_email">Email</label>
            <input id="r_email" class="input" type="email" placeholder="Email" required style="margin-top:.45rem" />
            <label class="skip" for="r_password">Password</label>
            <input id="r_password" class="input" type="password" placeholder="Create password (8+ characters)" required style="margin-top:.45rem" />
            <div style="display:flex;gap:.5rem;margin-top:.6rem;justify-content:flex-end">
              <button id="submitRegister" class="btn">Create account</button>
              <button id="backToSignIn" type="button" class="btn secondary">Back</button>
            </div>
          </form>

          <!-- Forgot password -->
          <form id="formForgot" style="display:none;margin-top:.6rem">
            <label class="skip" for="f_email">Email</label>
            <input id="f_email" class="input" type="email" placeholder="Enter your account email" required />
            <div style="display:flex;gap:.6rem;margin-top:.6rem;justify-content:flex-end">
              <button id="doForgot" class="btn">Send reset link</button>
              <button id="backToSignIn2" type="button" class="btn secondary">Back</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- basic toast host -->
  <div id="toastHost" aria-live="polite" style="position:fixed;right:1rem;bottom:1rem;z-index:1000"></div>

  <script>
    /*
      CHUNK 1 JS:
      - Lightweight IndexedDB wrapper (used for auth & user storage)
      - Sign up / Sign in handlers
      - Modal open/close & basic accessibility (focus)
      - Super admin triple-click on logo (opens admin — admin UI added in later chunk)
      - This chunk intentionally focuses on landing + auth; subsequent chunks will add Dashboard, Admin, Transactions, etc.
    */

    // Utilities
    const uid = (n=8) => { const chars='abcdefghijklmnopqrstuvwxyz0123456789'; let s=''; for(let i=0;i<n;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; };
    const nowISO = () => new Date().toISOString();
    function showToast(msg, type='info', t=3000){
      const host = document.getElementById('toastHost');
      const el = document.createElement('div');
      el.className = 'toast';
      el.textContent = msg;
      el.style.padding = '.65rem .9rem';
      el.style.borderRadius = '10px';
      el.style.background = type==='success' ? '#10b981' : type==='error' ? '#ef4444' : 'var(--primary)';
      el.style.color = '#fff';
      el.style.marginTop = '.5rem';
      host.appendChild(el);
      setTimeout(()=>el.remove(), t);
    }

    // SHA-256 helper for client-side hashing
    async function sha256(hexInput) {
      const enc = new TextEncoder();
      const data = enc.encode(hexInput);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    // Minimal IndexedDB wrapper
    const DB = (function(){
      const DBNAME = 'DGBank_Prod_v1', DBVER = 1;
      let db = null;
      function open(){
        return new Promise((resolve,reject)=>{
          if(db) return resolve(db);
          const r = indexedDB.open(DBNAME, DBVER);
          r.onupgradeneeded = (ev) => {
            const idb = ev.target.result;
            if(!idb.objectStoreNames.contains('users')){
              const s = idb.createObjectStore('users', { keyPath: 'id' });
              s.createIndex('email', 'email', { unique: true });
            }
            if(!idb.objectStoreNames.contains('accounts')){
              const s = idb.createObjectStore('accounts', { keyPath: 'id' });
              s.createIndex('userId','userId', { unique: false });
              s.createIndex('accountNumber','accountNumber', { unique: true });
            }
            if(!idb.objectStoreNames.contains('transactions')){
              idb.createObjectStore('transactions', { keyPath: 'id' });
            }
            if(!idb.objectStoreNames.contains('audit')){
              idb.createObjectStore('audit', { keyPath: 'id' });
            }
          };
          r.onsuccess = (e) => { db = e.target.result; resolve(db); };
          r.onerror = (e) => { console.error('DB open err',e); reject(e); };
        });
      }
      async function tx(storeNames, mode='readonly'){
        const d = await open();
        const t = d.transaction(storeNames, mode);
        const stores = {};
        for(const s of storeNames) stores[s] = t.objectStore(s);
        return { t, stores, complete: new Promise((res,rej)=>{ t.oncomplete=()=>res(); t.onerror=e=>rej(e); t.onabort=e=>rej(e); })};
      }
      return {
        add: async (store, obj) => {
          try{
            const { stores } = await tx([store], 'readwrite');
            return new Promise((res,rej)=>{ const r = stores[store].add(obj); r.onsuccess = ()=>res(obj); r.onerror=e=>rej(e); });
          }catch(e){
            // fallback to localStorage for resilience (not recommended for prod)
            const arr = JSON.parse(localStorage.getItem(store)||'[]'); arr.push(obj); localStorage.setItem(store, JSON.stringify(arr)); return obj;
          }
        },
        put: async (store, obj) => {
          const { stores } = await tx([store],'readwrite');
          return new Promise((res,rej)=>{ const r = stores[store].put(obj); r.onsuccess = ()=>res(obj); r.onerror=e=>rej(e); });
        },
        get: async (store, key) => {
          const { stores } = await tx([store], 'readonly');
          return new Promise((res,rej)=>{ const r = stores[store].get(key); r.onsuccess = ()=>res(r.result); r.onerror = e=>rej(e); });
        },
        getAll: async (store) => {
          try{
            const { stores } = await tx([store], 'readonly');
            return new Promise((res,rej)=>{ const r = stores[store].getAll(); r.onsuccess = ()=>res(r.result||[]); r.onerror=e=>rej(e); });
          }catch(e){
            return JSON.parse(localStorage.getItem(store)||'[]');
          }
        },
        delete: async (store, key) => {
          const { stores } = await tx([store], 'readwrite');
          return new Promise((res,rej)=>{ const r=stores[store].delete(key); r.onsuccess=()=>res(); r.onerror=e=>rej(e); });
        },
        clear: async (store) => {
          const { stores } = await tx([store], 'readwrite');
          return new Promise((res,rej)=>{ const r=stores[store].clear(); r.onsuccess=()=>res(); r.onerror=e=>rej(e); });
        }
      };
    })();

    /* Seed professional initial data if none exists.
       NOTE: For production this seeding would not be present.
       Since you requested a professional feel, seed uses realistic names and images,
       but these entries are initial test data to let the app run end-to-end.
    */
    async function seedIfEmpty(){
      try{
        const users = await DB.getAll('users');
        if(users.length>0) return;
        // create a superadmin (hidden access)
        const adminPassHash = await sha256('admin'); // default admin password for local management
        await DB.add('users', { id: 'u_superadmin', email: 'admin@deutscheglobal.bank', password: adminPassHash, firstName: 'System', lastName: 'Administrator', role: 'superadmin', createdAt: nowISO(), status: 'active' });
        // create sample professional users
        const people = [
          { first:'Lukas', last:'Müller', email:'lukas.mueller@company.de' },
          { first:'Anna', last:'Schmidt', email:'anna.schmidt@company.de' },
          { first:'Max', last:'Becker', email:'max.becker@business.de' },
          { first:'Sophie', last:'Fischer', email:'sophie.fischer@firm.de' }
        ];
        const defaultPassHash = await sha256('Welcome!2025');
        for(const p of people){
          const id = 'u_'+uid(8);
          await DB.add('users', { id, email: p.email, password: defaultPassHash, firstName: p.first, lastName: p.last, role: 'user', createdAt: nowISO(), status:'active' });
          // create a checking account
          const acc = { id: 'a_'+uid(9), userId: id, accountNumber: 'DE' + Math.floor(10000000 + Math.random()*89999999), accountType: 'checking', balance: Math.round((Math.random()*9000+1000)*100)/100, currency: 'EUR', status:'active', createdAt: nowISO() };
          await DB.add('accounts', acc);
        }
        showToast('Welcome to DeutscheGlobal — your account experience is ready', 'success', 4000);
      }catch(e){ console.error('Seed error', e); }
    }

    /* Auth - register & sign in logic */
    async function registerUser({ firstName, lastName, email, passwordPlain }){
      if(!email || !passwordPlain) throw new Error('Email and password are required');
      const emailLower = email.toLowerCase();
      const all = await DB.getAll('users');
      if(all.find(u=>u.email && u.email.toLowerCase()===emailLower)) throw new Error('An account with this email already exists');
      const id = 'u_'+uid(8);
      const hashed = await sha256(passwordPlain);
      const user = { id, email: emailLower, password: hashed, firstName, lastName, role: 'user', status: 'active', createdAt: nowISO() };
      await DB.add('users', user);
      // Create a primary checking account
      const account = { id: 'a_'+uid(9), userId: id, accountNumber: 'DE'+Math.floor(10000000 + Math.random()*89999999), accountType: 'checking', balance: 0.00, currency: 'EUR', status: 'active', createdAt: nowISO() };
      await DB.add('accounts', account);
      return user;
    }

    async function signIn(email, passwordPlain){
      const users = await DB.getAll('users');
      const hashed = await sha256(passwordPlain);
      const user = users.find(u => u.email && u.email.toLowerCase() === email.toLowerCase() && u.password === hashed);
      if(!user) throw new Error('Invalid credentials');
      // persist session minimally
      localStorage.setItem('dgb_session', JSON.stringify({ userId: user.id, ts: Date.now() }));
      return user;
    }

    async function signOut(){
      localStorage.removeItem('dgb_session');
      // reload to show landing; more graceful UI updates in next chunks
      location.reload();
    }

    /* UI wiring: auth modal show/hide and submit handlers */
    (function wireAuthUI(){
      const authModal = document.getElementById('authModal');
      const openSignIn = document.getElementById('openSignIn');
      const ctaRegister = document.getElementById('ctaOpenRegister');
      const closeAuth = document.getElementById('closeAuth');
      const btnOpenRegister = document.getElementById('openRegister');
      const btnBackToSign = document.getElementById('backToSignIn');
      const btnBackToSign2 = document.getElementById('backToSignIn2');
      const openForgot = document.getElementById('openForgot');
      const openContact = document.getElementById('openContact');

      openSignIn.addEventListener('click', ()=>{ openAuth('signin'); });
      ctaRegister.addEventListener('click', ()=>{ openAuth('register'); });
      btnOpenRegister.addEventListener('click', ()=>{ openAuth('register'); });
      closeAuth.addEventListener('click', ()=> { authModal.style.display = 'none'; });
      if(openForgot) openForgot.addEventListener('click', ()=> openAuth('forgot'));
      if(openContact) openContact.addEventListener('click', ()=> { showToast('Contact center — please call +49 30 1234 5678', 'info'); });

      function openAuth(mode='signin'){
        authModal.style.display = 'flex';
        const formSign = document.getElementById('formSignIn');
        const formReg = document.getElementById('formRegister');
        const formForgot = document.getElementById('formForgot');
        formSign.style.display = mode==='signin' ? 'block' : 'none';
        formReg.style.display = mode==='register' ? 'block' : 'none';
        formForgot.style.display = mode==='forgot' ? 'block' : 'none';
        // focus
        setTimeout(()=>{ if(mode==='signin') document.getElementById('si_email').focus(); if(mode==='register') document.getElementById('r_first').focus(); }, 120);
      }

      // Sign in submit
      document.getElementById('formSignIn').addEventListener('submit', async function(e){
        e.preventDefault();
        const email = document.getElementById('si_email').value.trim();
        const pw = document.getElementById('si_password').value.trim();
        if(!email || !pw){ showToast('Please provide email and password', 'error'); return; }
        try{
          const user = await signIn(email, pw);
          // basic UI transition; full dashboard will be rendered in chunk 2
          document.getElementById('appShell').style.display = 'block';
          document.getElementById('appContent').innerHTML = `<div style="padding:1rem"><h3>Welcome, ${user.firstName} ${user.lastName}</h3><p style="color:var(--muted)">Loading your workspace…</p></div>`;
          document.getElementById('authModal').style.display = 'none';
          showToast('Signed in', 'success');
          // in next chunks we'll populate dashboard; for now, set preview
          document.getElementById('uNamePreview').textContent = `${user.firstName} ${user.lastName}`;
          document.getElementById('uMailPreview').textContent = user.email;
          // trigger dashboard refresh (next chunk)
        }catch(err){
          showToast(err.message || 'Sign in failed', 'error');
        }
      });

      // Register submit
      document.getElementById('formRegister').addEventListener('submit', async function(e){
        e.preventDefault();
        const first = document.getElementById('r_first').value.trim();
        const last = document.getElementById('r_last').value.trim();
        const email = document.getElementById('r_email').value.trim();
        const pw = document.getElementById('r_password').value.trim();
        if(!first || !last || !email || pw.length < 8){ showToast('Complete all fields. Password must be at least 8 characters.', 'error'); return; }
        try{
          const user = await registerUser({ firstName: first, lastName: last, email, passwordPlain: pw });
          showToast('Your account has been created — please sign in', 'success');
          // Move back to sign in automatically
          openAuth('signin');
        }catch(err){
          showToast(err.message || 'Registration failed', 'error');
        }
      });

      // Forgot password (basic behavior) — in production integrate with secure email workflows
      document.getElementById('formForgot').addEventListener('submit', async function(e){
        e.preventDefault();
        const email = document.getElementById('f_email').value.trim();
        if(!email){ showToast('Please enter your email', 'error'); return; }
        // NOTE: production: trigger secure reset via backend. Here, we show friendly message.
        showToast('If an account exists with this email, you will receive reset instructions.', 'info');
        document.getElementById('formForgot').reset();
        openAuth('signin');
      });

      // back buttons
      btnBackToSign.addEventListener('click', ()=> openAuth('signin'));
      btnBackToSign2.addEventListener('click', ()=> openAuth('signin'));
    })();

    // Logo triple-click => open admin (hidden access)
    (function wireAdminSecret(){
      const logo = document.getElementById('siteLogo');
      let clicks = 0, timer = null;
      logo.addEventListener('click', async () => {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(()=> clicks = 0, 1200);
        if(clicks >= 3){
          clicks = 0;
          const pwd = prompt('Super Admin access — enter password:');
          if(pwd === 'admin/admin111'){
            // show admin modal (admin UI will be in chunk 3)
            // Temporarily use alert to confirm secret worked (admin UI injected later)
            showToast('Admin access granted — launching console', 'success');
            // in future chunk, this will call openAdmin()
            // Example placeholder:
            // openAdmin();
          } else {
            showToast('Invalid admin password', 'error');
          }
        }
      });
      // accessibility: allow Enter/Space to trigger
      logo.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); logo.click(); } });
    })();

    // Initialize DB seed & restore session if present
    (async function init(){
      await seedIfEmpty();
      try{
        const s = JSON.parse(localStorage.getItem('dgb_session') || 'null');
        if(s && s.userId){
          // fetch user and automatically show app shell preview (full dashboard in chunk 2)
          const users = await DB.getAll('users'); const u = users.find(x=>x.id === s.userId);
          if(u){
            document.getElementById('appShell').style.display = 'block';
            document.getElementById('landing').style.display = 'none';
            document.getElementById('uNamePreview').textContent = `${u.firstName} ${u.lastName}`;
            document.getElementById('uMailPreview').textContent = u.email;
          }
        }
      }catch(e){ console.warn('Session restore failed', e); }
    })();

    /* CHUNK 1 END - append CHUNK 2 (Dashboard, Accounts, Transfers, Transactions, PDF receipts, Admin CRUD, CSV/JSON import/export, WebSocket mock, EmailJS integration) here */
  </script>
</body>
</html>
